<!-- Code Generated by Sidekick is for learning and experimentation purposes only. -->
<!DOCTYPE html>
<html>
<head>
  <title>Management Team</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    .hidden { display: none; }
    label { display: block; margin-top: 10px; }
    input[type="text"], input[type="password"] { width: 200px; }
    button { margin-top: 10px; }
    ul { margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Management Team</h2>

  <!-- Login Form -->
  <div id="loginDiv">
    <label>Username: <input type="text" id="username"></label>
    <label>Password: <input type="password" id="password"></label>
    <button onclick="checkLogin()">Login</button>
    <div id="loginError" style="color:red"></div>
  </div>

  <!-- Captain Selection and Player Auction -->
  <div id="managementDiv" class="hidden">
    <h3>Enter Captains</h3>
    <label>Team A Captain: <input type="text" id="captainA"></label>
    <label>Team B Captain: <input type="text" id="captainB"></label>
    <button onclick="saveCaptains()">Save Captains</button>
    <div id="captainMsg" style="color:green"></div>
<div id="commonPlayerDisplay" style="color:#ffe082; font-weight:bold; margin-bottom:8px;"></div>

    <h3>Add Players for Auction</h3>
    <label>Player Name: <input type="text" id="playerName"></label>
    <label>Role: <input type="text" id="playerRole" placeholder="e.g. Batsman"></label>
    <button onclick="addPlayer()">Add Player</button>
    <div id="playerMsg" style="color:green"></div>
    <ul id="playerList"></ul>

    <button onclick="finalizeAuctionList()">Finalize Auction List</button>
    <div id="finalizeMsg" style="color:blue"></div>
  </div>

 <!-- Code Generated by Sidekick is for learning and experimentation purposes only. -->
<script>
let setupPlayers = [];
let numPlayers = 0;
let commonPlayer = null;

// Remove player from dropdown after adding
function removeFromDropdown(name, role) {
  const sel = document.getElementById('predefinedPlayers');
  for (let i = 0; i < sel.options.length; i++) {
    if (sel.options[i].value === `${name}|${role}`) {
      sel.remove(i);
      break;
    }
  }
}

document.getElementById('numPlayers').addEventListener('input', function() {
  numPlayers = parseInt(this.value, 10) || 0;
  setupPlayers = [];
  commonPlayer = null;
  document.getElementById('commonPlayerDisplay').textContent = "";
  // Reset dropdown to all options (optional: reload page for full reset)
  updatePlayerListPreview();
  document.getElementById('setupMsg').textContent = "";
});

function fillFromPredefined() {
  const sel = document.getElementById('predefinedPlayers');
  if(sel.value) {
    const [name, role] = sel.value.split('|');
    document.getElementById('playerName').value = name;
    document.getElementById('playerRole').value = role;
  }
}

function addPlayerToList() {
  if (!numPlayers) {
    document.getElementById('setupMsg').textContent = "Please enter the number of players first.";
    return;
  }
  // If commonPlayer is set, allow adding up to numPlayers (not exactly)
  if (!commonPlayer && setupPlayers.length >= numPlayers) {
    document.getElementById('setupMsg').textContent = "You have already added all players.";
    return;
  }
  const name = document.getElementById('playerName').value.trim();
  const role = document.getElementById('playerRole').value.trim();
  if (!name || !role) {
    document.getElementById('setupMsg').textContent = "Enter both player name and role.";
    return;
  }
  setupPlayers.push({ name, role });
  removeFromDropdown(name, role);
  document.getElementById('playerName').value = '';
  document.getElementById('playerRole').value = '';
  document.getElementById('predefinedPlayers').selectedIndex = 0;
  updatePlayerListPreview();
  document.getElementById('setupMsg').textContent = "";
}

function updatePlayerListPreview() {
  const preview = document.getElementById('playerListPreview');
  if (setupPlayers.length === 0) {
    preview.innerHTML = "<em>No players added yet.</em>";
  } else {
    preview.innerHTML = "<strong>Players:</strong><br>" +
      setupPlayers.map(p => `${p.name} (${p.role})`).join("<br>");
  }
}

document.getElementById('setupForm').onsubmit = function(e) {
  e.preventDefault();
  numPlayers = parseInt(document.getElementById('numPlayers').value, 10) || 0;
  const captainA = document.getElementById('captainA').value.trim();
  const captainB = document.getElementById('captainB').value.trim();
  if (!numPlayers || numPlayers < 2) {
    document.getElementById('setupMsg').textContent = "Please enter a valid number of players (at least 2).";
    return;
  }
  if (!captainA || !captainB) {
    document.getElementById('setupMsg').textContent = "Please enter both captain names.";
    return;
  }
  // If odd and no common selected, show modal for common player
  if (numPlayers % 2 === 1 && !commonPlayer) {
    if (setupPlayers.length !== numPlayers) {
      document.getElementById('setupMsg').textContent = `Please add exactly ${numPlayers} players before selecting the common player.`;
      return;
    }
    showCommonPlayerModal();
    return;
  }
  // If common is selected, allow less than numPlayers
  if (numPlayers % 2 === 1 && commonPlayer && setupPlayers.length < numPlayers) {
    // OK to proceed
  } else if (setupPlayers.length !== numPlayers && !commonPlayer) {
    document.getElementById('setupMsg').textContent = `Please add exactly ${numPlayers} players.`;
    return;
  }
  saveSetupAndShowAuction(captainA, captainB, commonPlayer);
};

// --- COMMON PLAYER MODAL LOGIC ---
function showCommonPlayerModal() {
  const modal = document.getElementById('commonPlayerModal');
  const select = document.getElementById('commonPlayerSelect');
  select.innerHTML = setupPlayers.map(
    (p, i) => `<option value="${i}">${p.name} (${p.role})</option>`
  ).join('');
  modal.style.display = "flex";
}

function confirmCommonPlayer() {
  const idx = document.getElementById('commonPlayerSelect').value;
  commonPlayer = setupPlayers.splice(idx, 1)[0];
  modalHide();
  document.getElementById('commonPlayerDisplay').textContent = "Common: " + commonPlayer.name;
  updatePlayerListPreview();
  document.getElementById('setupMsg').textContent = "Common player selected. You can now proceed to auction.";
}

function modalHide() {
  document.getElementById('commonPlayerModal').style.display = "none";
}

function saveSetupAndShowAuction(captainA, captainB, commonPlayer) {
  localStorage.setItem('captainA', captainA);
  localStorage.setItem('captainB', captainB);
  localStorage.setItem('auctionPlayers', JSON.stringify(setupPlayers));
  if (commonPlayer) {
    localStorage.setItem('commonPlayer', JSON.stringify(commonPlayer));
  } else {
    localStorage.removeItem('commonPlayer');
  }
  document.getElementById('setupMsg').textContent = "Saved! Click below to go to auction.";
  document.getElementById('gotoAuction').style.display = "block";
}

// Show preview if any players already added
updatePlayerListPreview();
</script>

</body>
</html>
